{% extends 'blog_base.html.twig' %}

{% block content %}
    {% for label, messages in app.flashes %}
        {% for message in messages %}
        <div style='margin-left:30%;'>
            <p class='{{ label }}' style='position:absolute; margin-top: -6vmin;'>{{ message }}</p>
        </div>
        {% endfor %}
    {% endfor %}

    <h1>Наилучший источник информации по теме "Путешествия"</h1>

    {% if posts %}
        {% set class = 'generalpost' %}
        {% for post in posts %}
            <div class='{{ class }}'>
            {% set class = 'viewpost' %}
                <a class='postLink' href='{{ path('post_show', {post_id: post.id}) }}'>
                    <div class='posttext'>
                        <p class='posttitle'>{{ post.title }}</p>
                        <p class='postcontent'>{{ post.content|striptags }}</p>
                        <p class='postdate'>{{ post.date_time|date('d.m.Y в H:i') }} &copy; {{ post.author }}</p>
                        <p class='postrating'>
                            {% if post.count_ratings %}
                                Рейтинг: {{ post.rating }}, оценок: {{ post.count_ratings }}, комментариев: {{ post.count_comments }}
                            {% else %}
                                Нет оценок. Будьте первым! Kомментариев: {{ post.count_comments }}
                            {% endif %}
                        </p>
                    </div>
                    <div class='postimage'>
                        <img src='/images/PostImgId{{ post.id }}.jpg' alt='Картинка'>
                    </div>
                </a>

                {% if is_granted('ROLE_ADMIN') %}
                <div class='submitunder'>
                    <input type='submit' form='deletePostById{{ post.id }}' value='Удалить пост с ID = {{ post.id }}' class='link'>
                    <form id='deletePostById{{ post.id }}' action='{{ path('post_delete', {id: post.id}) }}' method='post'>
                        <input type='hidden' value='{{ post.id }}' name='deletePostById'>
                    </form>
                </div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <div class='contentsinglepost'><p class='center'style='color: rgb(150, 20, 20);'>Нет информации для отображения</p></div>
    {% endif %}

    {% if posts|length > 9 %}
        <div class='contentsinglepost'><a class='formsubmit' href='{{ path('post_show_all') }}'>Посмотреть посты за всё время</a></div>
    {% endif %}

    {% if moreTalkedPosts %}
        <p style='text-align:center; font-size:16pt; margin-top:5%'>Самые обсуждаемые посты за неделю &darr;&darr;&darr;</p>
        {% for post in moreTalkedPosts %}
            <div class='viewpost'>
                <a class='postLink' href='{{ path('post_show', {post_id: post.id}) }}'>
                    <div class='posttext'>
                        <p class='posttitle'>{{ post.title }}</p>
                        <p class='postcontent'>{{ post.content|striptags }}</p>
                        <p class='postdate'>{{ post.date_time|date('d.m.Y в H:i') }} &copy; {{ post.author }}</p>
                        <p class='postrating'>
                            {% if post.count_ratings %}
                                Рейтинг: {{ post.rating }}, оценок: {{ post.count_ratings }}, комментариев: {{ post.count_comments }}
                            {% else %}
                                Нет оценок. Будьте первым! Kомментариев: {{ post.count_comments }}
                            {% endif %}
                        </p>
                    </div>
                    <div class='postimage'>
                        <img src='/images/PostImgId{{ post.id }}.jpg' alt='Картинка'>
                    </div>
                </a>

                {% if is_granted('ROLE_ADMIN') %}
                <div class='submitunder'>
                    <input type='submit' form='deletePostById{{ post.id }}' value='Удалить пост с ID = {{ post.id }}' class='link'>
                    <form id='deletePostById{{ post.id }}' action='{{ path('post_delete', {id: post.id}) }}' method='post'>
                        <input type='hidden' value='{{ post.id }}' name='deletePostById'>
                    </form>
                </div>
                {% endif %}
            </div>
        {% endfor %}
    {% endif %}
{% endblock %}